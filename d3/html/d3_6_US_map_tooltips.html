<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="../js/d3/d3.v3_5_17.js"></script>

    <style type="text/css">

        /* On mouse hover, lighten state color */
        path:hover {
            fill-opacity: .7;
        }

        /* Style for Custom Tooltip */
        div.tooltip {
            position: absolute;
            text-align: center;
            width: 260px;
            height: 55px;
            padding: 2px;
            font: 12px sans-serif;
            background: white;
            border: 0px;
            border-radius: 8px;
            pointer-events: none;
        }

        /* Legend Font Style */
        body {
            font: 11px sans-serif;
        }

        /* Legend Position Style */
        .legend {
            position:absolute;
            left:800px;
            top:350px;
        }

    </style>
</head>
<body>
<script type="text/javascript">

    /*

     http://bl.ocks.org/michellechandra/0b2ce4923dc9b5809922
     http://bl.ocks.org/michellechandra/raw/0b2ce4923dc9b5809922/

     This visualization was made possible by modifying code provided by:

     Scott Murray, Choropleth example from "Interactive Data Visualization for the Web"
     https://github.com/alignedleft/d3-book/blob/master/chapter_12/05_choropleth.html

     Malcolm Maclean, tooltips example tutorial
     http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html

     Mike Bostock, Pie Chart Legend
     http://bl.ocks.org/mbostock/3888852  */


    //Width and height of map
    var width = 960;
    var height = 500;

    // D3 Projection
    var projection = d3.geo.albersUsa()
            .translate([width/2, height/2])    // translate to center of screen
            .scale([1000]);          // scale things down so see entire US

    // Define path generator
    var path = d3.geo.path()               // path generator that will convert GeoJSON to SVG paths
            .projection(projection);  // tell path generator to use albersUsa projection


    // Define linear scale for output
    var color = d3.scale.linear()
            .range(["rgb(127,255,212)","rgb(255,99,71)"]);

    var legendText = ["5 most positive Tweets", "5 most negative Tweets"];

    //Create SVG element and append map to the SVG
    var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

    // Append Div for tooltip to SVG
    var div = d3.select("body")
            .append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);
    // Load in my states data!


// Load GeoJSON data and merge with cities-lived data
  d3.json("../maps/us-states.json", function(json) {

            // Bind the data to the SVG and create one path per GeoJSON feature
            svg.selectAll("path")
                    .data(json.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .style("stroke", "#fff")
                    .style("stroke-width", "1")
                    .style("fill", "rgb(213,222,217)");

            // Modified Legend Code from Mike Bostock: http://bl.ocks.org/mbostock/3888852
            var legend = d3.select("body").append("svg")
                    .attr("class", "legend")
                    .attr("width", 140)
                    .attr("height", 200)
                    .selectAll("g")
                    .data(color.domain().slice())
                    .enter()
                    .append("g")
                    .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

            legend.append("rect")
                    .attr("width", 18)
                    .attr("height", 18)
                    .style("fill", color);

            legend.append("text")
                    .data(legendText)
                    .attr("x", 24)
                    .attr("y", 9)
                    .attr("dy", ".35em")
                    .text(function(d) { return d; });

      //http://www.w3schools.com/svg
      // cities of positive tweets
      d3.json("../data/USA-positive.json", function(error, data) {
          if (error) return console.warn(error);
          var tweets = data.results;

          svg.selectAll("positiveCircle")
                  .data(tweets)
                  .enter()
                  .append("circle")
                  .attr("class", "positiveCircle")
                  .attr("cx", function(d) {
                      return projection([d.geo.coordinates[1], d.geo.coordinates[0]])[0];
                  })
                  .attr("cy", function(d) {
                      return projection([d.geo.coordinates[1], d.geo.coordinates[0]])[1];
                  })
                  .attr("r", function(d) {
                      //TODO hacer el radio dinamico segun la probabilidad del sentimiento
                      return 4;
                  })
                  .style("fill", "rgb(127,255,212)")
                  .style("opacity",.8)

                  // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks"
                  // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
                  .on("mouseover", function(d) {
                      div.transition()
                              .duration(200)
                              .style("opacity", .9);
                      div.text(d.text)
                              .style("left", (d3.event.pageX + 20) + "px")
                              .style("top", (d3.event.pageY - 28) + "px");
                  })

                  // fade out tooltip on mouse out
                  .on("mouseout", function(d) {
                      div.transition()
                              .duration(500)
                              .style("opacity", 0);
                  });
          svg.selectAll(".place-pos-label")
                  .data(tweets)
                  .enter()
                  .append("text")
                  .attr("class", ".place-pos-label")
                  .attr("transform", function(d) { return "translate(" + projection([d.geo.coordinates[1], d.geo.coordinates[0]])  + ")"; })
                  .attr("dx", "-2em")
                  .attr("dy", "1.5em")
                  .text(function(d) { return d.place.name; });
      });

      // cities of negative tweets
      d3.json("../data/USA-negative.json", function(error, data) {
          if (error) return console.warn(error);
          var tweets = data.results;

          svg.selectAll("negativeCircle")
                  .data(tweets)
                  .enter()
                  .append("circle")
                  .attr("class", "negativeCircle")
                  .attr("cx", function(d) {
                      return projection([d.geo.coordinates[1], d.geo.coordinates[0]])[0];
                  })
                  .attr("cy", function(d) {
                      return projection([d.geo.coordinates[1], d.geo.coordinates[0]])[1];
                  })
                  .attr("r", function(d) {
                      //TODO hacer el radio dinamico segun la probabilidad del sentimiento
                      return 4;
                  })
                  .style("fill", "rgb(255,99,71)")
                  .style("opacity",.8)

                  // Modification of custom tooltip code provided by Malcolm Maclean, "D3 Tips and Tricks"
                  // http://www.d3noob.org/2013/01/adding-tooltips-to-d3js-graph.html
                  .on("mouseover", function(d) {
                      div.transition()
                              .duration(200)
                              .style("opacity", .9);
                      div.text(d.text)
                              .style("left", (d3.event.pageX + 20) + "px")
                              .style("top", (d3.event.pageY - 28) + "px");
                  })

                  // fade out tooltip on mouse out
                  .on("mouseout", function(d) {
                      div.transition()
                              .duration(500)
                              .style("opacity", 0);
                  });

          svg.selectAll(".place-neg-label")
                  .data(tweets)
                  .enter()
                  .append("text")
                  .attr("class", ".place-neg-label")
                  .attr("transform", function(d) { return "translate(" + projection([d.geo.coordinates[1], d.geo.coordinates[0]])  + ")"; })
                  .attr("dx", "-2em")
                  .attr("dy", "1.5em")
                  .text(function(d) { return d.place.name; });
      });
  });



</script>
</body>
</html>